/*!
 * @pixi/gif - v2.1.0
 * Compiled Sat, 07 Jan 2023 00:42:45 UTC
 *
 * @pixi/gif is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2023, Matt Karl @bigtimebuddy, All Rights Reserved
 */this.PIXI=this.PIXI||{},this.PIXI.gif=function(D,_,K){"use strict";var Ee=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function De(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ze(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&Object.keys(t).length===1?t.default:t}function Ge(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var e=function a(){if(this instanceof a){var n=[null];n.push.apply(n,arguments);var i=Function.bind.apply(r,n);return new i}return r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}),e}var k={},z={},T={};Object.defineProperty(T,"__esModule",{value:!0});var J=T.loop=ee=T.conditional=V=T.parse=void 0,Q=function t(r,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a;if(Array.isArray(e))e.forEach(function(o){return t(r,o,a,n)});else if(typeof e=="function")e(r,a,n,t);else{var i=Object.keys(e)[0];Array.isArray(e[i])?(n[i]={},t(r,e[i],a,n[i])):n[i]=e[i](r,a,n,t)}return a},V=T.parse=Q,W=function(r,e){return function(a,n,i,o){e(a,n,i)&&o(a,r,n,i)}},ee=T.conditional=W,te=function(r,e){return function(a,n,i,o){for(var s=[],c=a.pos;e(a,n,i);){var p={};if(o(a,r,n,p),a.pos===c)break;c=a.pos,s.push(p)}return s}};J=T.loop=te;var h={};Object.defineProperty(h,"__esModule",{value:!0});var re=h.readBits=ge=h.readArray=fe=h.readUnsigned=pe=h.readString=ce=h.peekBytes=de=h.readBytes=oe=h.peekByte=ie=h.readByte=ne=h.buildStream=void 0,ae=function(r){return{data:r,pos:0}},ne=h.buildStream=ae,R=function(){return function(r){return r.data[r.pos++]}},ie=h.readByte=R,se=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+r]}},oe=h.peekByte=se,P=function(r){return function(e){return e.data.subarray(e.pos,e.pos+=r)}},de=h.readBytes=P,ue=function(r){return function(e){return e.data.subarray(e.pos,e.pos+r)}},ce=h.peekBytes=ue,le=function(r){return function(e){return Array.from(P(r)(e)).map(function(a){return String.fromCharCode(a)}).join("")}},pe=h.readString=le,he=function(r){return function(e){var a=P(2)(e);return r?(a[1]<<8)+a[0]:(a[0]<<8)+a[1]}},fe=h.readUnsigned=he,ve=function(r,e){return function(a,n,i){for(var o=typeof e=="function"?e(a,n,i):e,s=P(r),c=new Array(o),p=0;p<o;p++)c[p]=s(a);return c}},ge=h.readArray=ve,ye=function(r,e,a){for(var n=0,i=0;i<a;i++)n+=r[e+i]&&Math.pow(2,a-i-1);return n},me=function(r){return function(e){for(var a=R()(e),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(a&1<<i);return Object.keys(r).reduce(function(o,s){var c=r[s];return c.length?o[s]=ye(n,c.index,c.length):o[s]=n[c.index],o},{})}};re=h.readBits=me,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=T,e=h,a={blocks:function(d){for(var f=0,u=[],y=d.data.length,m=0,g=(0,e.readByte)()(d);g!==f&&g;g=(0,e.readByte)()(d)){if(d.pos+g>=y){var x=y-d.pos;u.push((0,e.readBytes)(x)(d)),m+=x;break}u.push((0,e.readBytes)(g)(d)),m+=g}for(var b=new Uint8Array(m),w=0,B=0;B<u.length;B++)b.set(u[B],w),w+=u[B].length;return b}},n=(0,r.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===249}),i=(0,r.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,e.readArray)(3,function(l,d,f){return Math.pow(2,f.descriptor.lct.size+1)})},function(l,d,f){return f.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},a]}]},function(l){return(0,e.peekByte)()(l)===44}),o=(0,r.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(d,f,u){return(0,e.readBytes)(u.text.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===1}),s=(0,r.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(d,f,u){return(0,e.readString)(u.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===255}),c=(0,r.conditional)({comment:[{codes:(0,e.readBytes)(2)},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===254}),p=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,r.conditional)({gct:(0,e.readArray)(3,function(l,d){return Math.pow(2,d.lsd.gct.size+1)})},function(l,d){return d.lsd.gct.exists}),{frames:(0,r.loop)([n,s,c,i,o],function(l){var d=(0,e.peekByte)()(l);return d===33||d===44})}],v=p;t.default=v}(z);var Re=Z(z),A={};Object.defineProperty(A,"__esModule",{value:!0});var _e=A.deinterlace=void 0,xe=function(r,e){for(var a=new Array(r.length),n=r.length/e,i=function(d,f){var u=r.slice(f*e,(f+1)*e);a.splice.apply(a,[d*e,e].concat(u))},o=[0,4,2,1],s=[8,8,4,2],c=0,p=0;p<4;p++)for(var v=o[p];v<n;v+=s[p])i(v,c),c++;return a};_e=A.deinterlace=xe;var O={};Object.defineProperty(O,"__esModule",{value:!0});var be=O.lzw=void 0,we=function(r,e,a){var n=4096,i=-1,o=a,s,c,p,v,l,d,f,S,u,y,B,m,F,I,E,M,g=new Array(a),x=new Array(n),b=new Array(n),w=new Array(n+1);for(m=r,c=1<<m,l=c+1,s=c+2,f=i,v=m+1,p=(1<<v)-1,u=0;u<c;u++)x[u]=0,b[u]=u;var B,S,j,F,I,M,E;for(B=S=j=F=I=M=E=0,y=0;y<o;){if(I===0){if(S<v){B+=e[E]<<S,S+=8,E++;continue}if(u=B&p,B>>=v,S-=v,u>s||u==l)break;if(u==c){v=m+1,p=(1<<v)-1,s=c+2,f=i;continue}if(f==i){w[I++]=b[u],f=u,F=u;continue}for(d=u,u==s&&(w[I++]=F,u=f);u>c;)w[I++]=b[u],u=x[u];F=b[u]&255,w[I++]=F,s<n&&(x[s]=f,b[s]=F,s++,!(s&p)&&s<n&&(v++,p+=s)),f=d}I--,g[M++]=w[I],y++}for(y=M;y<o;y++)g[y]=0;return g};be=O.lzw=we,Object.defineProperty(k,"__esModule",{value:!0});var L=k.decompressFrames=Ae=k.decompressFrame=N=k.parseGIF=void 0,Be=ke(z),Te=T,Fe=h,Ie=A,Se=O;function ke(t){return t&&t.__esModule?t:{default:t}}var Ce=function(r){var e=new Uint8Array(r);return(0,Te.parse)((0,Fe.buildStream)(e),Be.default)},N=k.parseGIF=Ce,Pe=function(r){for(var e=r.pixels.length,a=new Uint8ClampedArray(e*4),n=0;n<e;n++){var i=n*4,o=r.pixels[n],s=r.colorTable[o]||[0,0,0];a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=o!==r.transparentIndex?255:0}return a},X=function(r,e,a){if(!r.image){console.warn("gif frame does not have associated image.");return}var n=r.image,i=n.descriptor.width*n.descriptor.height,o=(0,Se.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(o=(0,Ie.deinterlace)(o,n.descriptor.width));var s={pixels:o,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?s.colorTable=n.lct:s.colorTable=e,r.gce&&(s.delay=(r.gce.delay||10)*10,s.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(s.transparentIndex=r.gce.transparentColorIndex)),a&&(s.patch=Pe(s)),s},Ae=k.decompressFrame=X,Oe=function(r,e){return r.frames.filter(function(a){return a.image}).map(function(a){return X(a,r.gct,e)})};L=k.decompressFrames=Oe;var Ue=Object.defineProperty,U=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,H=(t,r,e)=>r in t?Ue(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,je=(t,r)=>{for(var e in r||(r={}))$.call(r,e)&&H(t,e,r[e]);if(U)for(var e of U(r))q.call(r,e)&&H(t,e,r[e]);return t},Me=(t,r)=>{var e={};for(var a in t)$.call(t,a)&&r.indexOf(a)<0&&(e[a]=t[a]);if(t!=null&&U)for(var a of U(t))r.indexOf(a)<0&&q.call(t,a)&&(e[a]=t[a]);return e};const C=class extends K.Sprite{constructor(t,r){super(_.Texture.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0;const e=Object.assign({},C.defaultOptions,r),{scaleMode:a,width:n,height:i}=e,o=Me(e,["scaleMode","width","height"]),s=document.createElement("canvas"),c=s.getContext("2d");s.width=n,s.height=i,this.texture=_.Texture.from(s,{scaleMode:a}),this.duration=t[t.length-1].end,this._frames=t,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,o),this.currentFrame=0,o.autoPlay&&this.play()}static fromBuffer(t,r){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const e=y=>{var m;let g=null;for(const x of y.frames)g=(m=x.gce)!=null?m:g,"image"in x&&!("gce"in x)&&(x.gce=g)},a=N(t);e(a);const n=L(a,!0),i=[],o=document.createElement("canvas"),s=o.getContext("2d",{willReadFrequently:!0}),c=document.createElement("canvas"),p=c.getContext("2d");o.width=a.lsd.width,o.height=a.lsd.height;let v=0;const{fps:l}=Object.assign({},C.defaultOptions,r),d=1e3/l;for(let y=0;y<n.length;y++){const{disposalType:m=2,delay:g=d,patch:x,dims:{width:b,height:w,left:B,top:S}}=n[y];c.width=b,c.height=w,p.clearRect(0,0,b,w);const j=p.createImageData(b,w);j.data.set(x),p.putImageData(j,0,0),s.drawImage(c,B,S);const F=s.getImageData(0,0,o.width,o.height);(m===2||m===3)&&s.clearRect(0,0,o.width,o.height),i.push({start:v,end:v+g,imageData:F}),v+=g}o.width=o.height=0,c.width=c.height=0;const{width:f,height:u}=a.lsd;return new C(i,je({width:f,height:u},r))}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(_.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(_.Ticker.shared.add(this.update,this,_.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var r,e;if(!this._playing)return;const a=this.animationSpeed*t/_.settings.TARGET_FPMS,n=this._currentTime+a,i=n%this.duration,o=this._frames.findIndex(s=>s.start<=i&&s.end>i);n>=this.duration?this.loop?(this._currentTime=i,this.updateFrameIndex(o),(r=this.onLoop)==null||r.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(e=this.onComplete)==null||e.call(this),this.stop()):(this._currentTime=i,this.updateFrameIndex(o))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(t){this.updateFrame(),super._render(t)}_renderCanvas(t){this.updateFrame(),super._renderCanvas(t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(_.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(_.Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var r;if(t<0||t>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${t}`);this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(r=this.onFrameChange)==null||r.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(){return new C([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.baseTexture.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop})}};let G=C;G.defaultOptions={scaleMode:_.SCALE_MODES.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const Y={extension:_.ExtensionType.Asset,detection:{test:async()=>!0,add:async t=>[...t,"gif"],remove:async t=>t.filter(r=>r!=="gif")},loader:{test:t=>_.utils.path.extname(t)===".gif",load:async(t,r)=>{const e=await(await _.settings.ADAPTER.fetch(t)).arrayBuffer();return G.fromBuffer(e,r==null?void 0:r.data)},unload:async t=>{t.destroy()}}};return _.extensions.add(Y),D.AnimatedGIF=G,D.AnimatedGIFAsset=Y,D}({},PIXI,PIXI);
//# sourceMappingURL=pixi-gif.js.map
